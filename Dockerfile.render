FROM python:3.11-slim

WORKDIR /app

# Copier seulement pyproject pour le cache
COPY pyproject.toml ./

# Installer uv et les dépendances
RUN pip install --no-cache-dir uv \
    && pip install --no-cache-dir torch torchaudio --index-url https://download.pytorch.org/whl/cpu \
    && uv sync --no-dev

# Copier le reste du projet
COPY . .

# Rendre le script exécutable
RUN chmod +x /app/start_services.sh

EXPOSE 3000
CMD ["/app/start_services.sh"]
